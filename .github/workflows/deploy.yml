name: Deploy React App

on:
  push:
    branches: ["main"]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: "18"

      - name: Install dependencies
        run: npm install

      - name: Fix Leaf component in App.js
        run: |
          cp src/App.js src/App.js.backup
          sed -i 's/const Leaf = (props) => (/const Leaf = (props) => (\n  <svg \n    {...props} \n    viewBox="0 0 24 24" \n    fill="none" \n    stroke="currentColor" \n    strokeWidth="2"\n    strokeLinecap="round" \n    strokeLinejoin="round"\n  >\n    <path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z" \/>\n    <path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12" \/>\n  <\/svg>/' src/App.js

      - name: Create main.jsx
        run: |
          cat > src/main.jsx << 'EOF'
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.js'
import './index.css'

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
)
EOF

      - name: Create index.html
        run: |
          cat > index.html << 'EOF'
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BatikCraft - Traditional Batik E-Commerce</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
EOF

      - name: Create vite.config.js
        run: |
          cat > vite.config.js << 'EOF'
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  base: '/batik-app/',
  build: {
    outDir: 'dist'
  }
})
EOF

      - name: Build project
        run: npm run build

      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages
          folder: dist
